<section style="margin-left:auto; margin-right:auto; width:fit-content">
	<form autocomplete="off" style="display:flex; flex-direction:column;" id="join-form">
		<label for="room-code">Room Code</label>
		<input required minlength="4" placeholder="XXXX" type="text" id="room-code" name="room-code">
		<!-- <br> -->
		<label for="player-name">Name</label>
		<input maxlength="12" placeholder="Enter your name" type="text" id="player-name" name="player-name">
		<br>
		<input disabled id="join-button" type="submit" value="Join">
	</form>
</section>

<script>
	{
		var joinForm = document.getElementById("join-form");
		var roomCode = document.getElementById("room-code");
		var playerName = document.getElementById("player-name");
		var joinButton = document.getElementById("join-button");

		async function verify_room_code() {
			if (roomCode.value.length >= 4) {
				var check = await Player.checkLobby(roomCode.value);
				if (check != null && check.state == 0) {
					joinButton.removeAttribute("disabled");
					return;
				}
			}

			joinButton.setAttribute("disabled", true);
		}

		joinForm.onsubmit = (e) => {
			e.preventDefault();

			player = new Player(roomCode.value, playerName.value);
		};

		roomCode.oninput = (_) => {
			verify_room_code();
		};

		async function check_stored_lobby() {
			var stored = Player.readFromLocalStorage();
			if (stored != null) {
				var check = await Player.checkLobby(stored.lobbyId);
				if (check != null) {
					roomCode.value = stored.lobbyId;
					playerName.value = stored.username;
					verify_room_code();
				}
			}
		}

		check_stored_lobby();
	}
</script>